// Module included in the following assemblies:
//
// * operators/operator_sdk/osdk-golang-tutorial.adoc

[id="osdk-golang-define-api_{context}"]
= Defining the API

Define the API for the `Memcached` custom resource (CR).

.Procedure

. Modify the Go type definitions at `api/v1alpha1/memcached_types.go` to have the following `spec` and `status`:
+
[source,go]
----
// MemcachedSpec defines the desired state of Memcached
type MemcachedSpec struct {
	// +kubebuilder:validation:Minimum=0
	// Size is the size of the memcached deployment
	Size int32 `json:"size"`
}

// MemcachedStatus defines the observed state of Memcached
type MemcachedStatus struct {
	// Nodes are the names of the memcached pods
	Nodes []string `json:"nodes"`
}
----

. Add the `+kubebuilder:subresource:status` marker to add a `status` subresource to the CRD manifest:
+
[source,go]
----
// Memcached is the Schema for the memcacheds API
// +kubebuilder:subresource:status
type Memcached struct {
	metav1.TypeMeta   `json:",inline"`
	metav1.ObjectMeta `json:"metadata,omitempty"`

	Spec   MemcachedSpec   `json:"spec,omitempty"`
	Status MemcachedStatus `json:"status,omitempty"`
}
----
+
This enables the controller to update the CR status without changing the rest of the CR object:

. After modifying a `*_types.go` file, always run the following command to update the generated code for that resource type:
+
[source,terminal]
----
$ make generate
----
+
The above Makefile target invokes the `controller-gen` utility to update the `api/v1alpha1/zz_generated.deepcopy.go` file. This ensures your API Go type definitions implement the `runtime.Object` interface that all Kind types must implement.
